<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Risco para Desportos de Natureza</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Firebase SDK (using modern versions) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      window.firebase = { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp };
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .tab-button.active { border-color: #3b82f6; color: #3b82f6; font-weight: 600; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .btn { transition: all 0.2s; } .btn:hover { transform: translateY(-2px); }
        .btn-primary { background-color: #3b82f6; color: white; } .btn-primary:hover { background-color: #2563eb; }
        .btn-secondary { background-color: #6b7280; color: white; } .btn-secondary:hover { background-color: #4b5563; }
        .btn-danger { background-color: #ef4444; color: white; } .btn-danger:hover { background-color: #dc2626; }
        .btn-success { background-color: #22c55e; color: white; } .btn-success:hover { background-color: #16a34a; }
        .risk-matrix-container { display: grid; grid-template-columns: auto 1fr; gap: 0.5rem; align-items: center; }
        .risk-matrix { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; border: 1px solid #d1d5db; border-radius: 0.25rem; padding: 2px; width: 150px; }
        .matrix-cell { aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 500; color: white; cursor: pointer; border-radius: 0.125rem; }
        .matrix-cell.selected { border: 2px solid #ffffff; box-shadow: 0 0 0 2px #3b82f6; transform: scale(1.1); z-index: 5; }
        .axis-label { writing-mode: vertical-rl; transform: rotate(180deg); text-align: center; font-size: 0.75rem; font-weight: 600; color: #4b5563; }
        .consequence-labels { grid-column: 2; display: grid; grid-template-columns: repeat(5, 1fr); text-align: center; font-size: 0.75rem; font-weight: 600; color: #4b5563; }
        .risk-low { background-color: #22c55e; } .risk-moderate { background-color: #facc15; }
        .risk-high { background-color: #f97316; } .risk-extreme { background-color: #ef4444; }
        .extreme-risk-alert-row { border: 2px solid #ef4444 !important; background-color: #fef2f2; }
        .extreme-risk-icon { color: #ef4444; display: none; } .extreme-risk-alert-row .extreme-risk-icon { display: inline-block; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        #material-emergencia-container {
            display: grid;
            gap: 1rem;
            grid-template-columns: 1fr;
        }
        @media (min-width: 640px) { #material-emergencia-container { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { #material-emergencia-container { grid-template-columns: repeat(3, 1fr); } }
        @media print { body * { visibility: hidden; } .print-section, .print-section * { visibility: visible; } .print-section { position: absolute; left: 0; top: 0; width: 100%; } .no-print { display: none; } }
        #loading-spinner { border-top-color: #3498db; }
        
        /* Estilo para a notificação */
        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }
        #notification.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -10px);
        }
        #notification.bg-red-500 { background-color: #ef4444; }
        #notification.bg-blue-500 { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon-alert-triangle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </symbol>
    </svg>

    <div id="app-container" class="container mx-auto p-4 md:p-8" style="display: none;">
        <header class="text-center mb-8 no-print">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Modelo de análise do risco para a prevenção de acidentes em desportos de natureza</h1>
            <p class="text-md text-gray-600 mt-2">Modelo de (Carlos Mata; Catarina Pereira e Luís Carvalhinho 2023)</p>
        </header>

        <div class="mb-6 border-b border-gray-200 no-print">
            <nav class="flex flex-wrap justify-center space-x-4" aria-label="Tabs">
                <button id="tab-fase1" class="tab-button active py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2">Fase 1: Análise Preliminar</button>
                <button id="tab-fase2" class="tab-button py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2">Fase 2: Avaliação CMAR</button>
                <button id="tab-fase3" class="tab-button py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2">Painel de Controlo</button>
            </nav>
        </div>

        <main>
            <div id="fase1" class="tab-content active print-section"><!-- Content Filled by JS --></div>
            <div id="fase2" class="tab-content print-section"><!-- Content Filled by JS --></div>
            <div id="fase3" class="tab-content"><!-- Content Filled by JS --></div>
        </main>
    </div>
    
    <div id="loading-overlay" class="fixed inset-0 bg-white flex flex-col justify-center items-center">
        <div id="loading-spinner" class="w-12 h-12 border-4 border-gray-200 rounded-full animate-spin"></div>
        <p class="mt-4 text-gray-600">A carregar aplicação...</p>
    </div>

    <!-- Elemento para as notificações -->
    <div id="notification"></div>

    <script type="module">
        // App logic wrapped in a function to be called after the DOM is ready
        function main() {
            try {
                const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } = window.firebase;

                // ===================================================================================
                // IMPORTANTE: CONFIGURAÇÃO DO FIREBASE
                // ===================================================================================
                const GITHUB_FIREBASE_CONFIG = {
                    apiKey: "AIzaSyCcpSTYkV5SumpC28J9NwFHmmQKW6Dp9vo",
                    authDomain: "modelo-analise-de-risco.firebaseapp.com",
                    projectId: "modelo-analise-de-risco",
                    storageBucket: "modelo-analise-de-risco.appspot.com",
                    messagingSenderId: "808630343356",
                    appId: "1:808630343356:web:f7c54d8fd7cb4249a3a2b9",
                    measurementId: "G-PPDK22QY2N"
                };
                
                const finalFirebaseConfig = typeof __firebase_config !== 'undefined' 
                    ? JSON.parse(__firebase_config) 
                    : GITHUB_FIREBASE_CONFIG;
                
                const appId_str = typeof __app_id !== 'undefined' ? __app_id : 'github-hosted-app';
                
                if (typeof __firebase_config === 'undefined' && finalFirebaseConfig.apiKey.includes("COLE_A_SUA")) {
                    document.body.innerHTML = `<div class="p-8 text-center bg-red-100 text-red-800"><h1>Erro de Configuração</h1><p>As chaves de configuração do Firebase não foram preenchidas no ficheiro index.html. Siga as instruções no código para configurar a sua aplicação.</p></div>`;
                    throw new Error("A configuração do Firebase não foi definida.");
                }

                const app = initializeApp(finalFirebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                
                const medidasSeguranca = ["Políticas e programas de treino em deportos de natureza.", "Tomada de decisão em domínios complexos, dinâmicos e de alto risco.", "Investigação profunda dos riscos no contexto de desporto natureza.", "Código de conduta para o setor.", "Prevenção apoiada na abordagem de experiências do praticante.", "Utilização de matriz de risco para obtenção de níveis gerais por praticante.", "Bom aquecimento.", "Treino teórico e prático de procedimentos de segurança, incluindo primeiros socorros e técnicas de escalada de resgate.", "Registo das ocorrências de acidentes.", "Fiscalização das licenças e seguros.", "Reavaliações regulares das capacidades do instrutor para a gestão do risco primeiros socorros e desenvolvimento de 'habilidades sociais'.", "Compreender melhor a relação entre a perceção e a exposição ao risco.", "Perceber a competência técnica para escalar em segurança.", "Mais investigação sobre o Risco em todas modalidades de desporto natureza e em vários países.", "Gestão por parte das autoridades locais, governamentais e reguladoras.", "Desenvolver sistemas padronizados para relatórios de acidentes e incidente.", "Banco de dados universal de acidentes/incidentes em atividades de natureza.", "Desenvolvimento de taxonomias do sistema de falhas e erro humano.", "Educar o praticante para medidas preventivas eficazes.", "Comunicação do risco através de diferentes canais, como redes sociais, brochuras ou sistemas interativos de interpretação.", "A avaliação de vídeo como técnica de análise do risco na recreação ao ar livre.", "Investigação em fatores de análise do risco, como sexo, idade, comportamentos, ou nível de especialização.", "Discussão entre técnicos para definir estratégias de redução dos riscos.", "Identificar decisões erradas ou falta de habilidade por parte dos instrutores.", "Melhorar os formulários de consentimento e informações dos participantes.", "Comunicar os riscos associados aos participantes.", "Os técnicos devem ter o poder de abortar as atividades ou impedir os participantes de participarem.", "Desenvolver estratégias de gestão do risco mais adequadas em torno da presença de terreno inseguro ou clima adverso durante as atividades."];
                const materialEmergencia = { "Material Geral": ["Luvas", "Soro fisiológico", "Spray antisséptico", "Pensos rápidos", "Tesoura", "Fita adesiva (pequena)", "Fita adesiva de 5cm", "Pinça", "Gaze", "Lençol isotérmico", "Saco de frio", "Saco de calor", "Saco para lixo"], "Equipamentos de medição": ["Medidor pressão arterial", "Oxímetro (SPo2)", "Medidor de glicémia", "Lanterna pupilas", "Termómetro"], "Respiratório": ["Máscara pocket (PCR)", "Conjunto tubos orofaríngeos"], "Queimaduras": ["Gel para queimaduras", "Gaze gorda", "Lençol para queimados", "Protetor solar"], "Hemorragias": ["Garrote", "Ligadura Israelita", "Caneta demográfica (permite escrever na pele)", "Cinto Pélvico (em substituição, lençol térmico)", "Ligaduras", "Compressas esterilizadas", "Torniquete", "Compressas hemostáticas", "Pensos de união (suturas)"], "Trauma": ["Colar cervical (ajustável)", "Talas (vários tamanhos)", "Ligaduras", "Corda 10m"], "Medicação": ["Paracetamol", "Açúcar ou gel açucarado", "Anti-histamínico (ex.: cetirizina)", "Repelente de insetos"], "Comunicações": ["Telemóvel", "Walkie talkie portátil", "GPS", "Painel solar"], "Kit de sobrevivência": ["Apito", "Lanterna (frontal)", "Faca", "Pastilha para purificação de água", "Isqueiro de pedras"] };
                const riskData = { "Humanos": [{ id: "H1", text: "Nível de experiência na modalidade (Técnico)" }, { id: "H2", text: "Competências de resgate e socorrismo (Técnico)" }, { id: "H3", text: "Informações de segurança aos praticantes (Técnico)" }, { id: "H4", text: "Rácio técnico/praticantes" }, { id: "H5", text: "Utilização de procedimentos de segurança (Técnico)" }, { id: "H6", text: "Capacidade de liderança e decisão (Técnico)" }, { id: "H7", text: "Competências de planeamento e gestão (Técnico)" }, { id: "H8", text: "Conhecimento dos locais e perigos (Técnico)" }, { id: "H9", text: "Competências de intervenção pedagógica (Técnico)" }, { id: "H10", text: "Condição física (Técnico)" }, { id: "H11", text: "Vestuário e calçado adequado (Praticante)" }, { id: "H12", text: "Nível de experiência (Praticante)" }, { id: "H13", text: "Conduta de segurança (Praticante)" }], "Ambiental": [{ id: "A1", text: "Temperatura" }, { id: "A2", text: "Condições adversas extremas (vento, chuva, etc)" }, { id: "A3", text: "Estado de conservação do meio" }, { id: "A4", text: "Acesso a veículos de socorro" }, { id: "A5", text: "Comunicações (rede telemóvel, rádios)" }, { id: "A6", text: "Dificuldade do percurso" }, { id: "A7", text: "Duração do percurso" }, { id: "A8", text: "Nível da água (Canyoning)" }, { id: "A9", text: "Qualidade da rocha (Canyoning/Escalada)" }, { id: "A10", text: "Exposição solar (Escalada)" }], "Materiais e Equipamentos": [{ id: "M1", text: "Utilização de materiais certificados" }, { id: "M2", text: "Manutenção dos materiais" }, { id: "M3", text: "Características dos materiais" }, { id: "M4", text: "Manipulação dos materiais" }, { id: "M5", text: "Adequação dos materiais aos praticantes" }, { id: "M6", text: "Estado dos equipamentos fixos (Escalada)" }, { id: "M7", text: "Performance dos materiais" }], "Segurança e Emergência": [{ id: "S1", text: "Equipamento para comunicações" }, { id: "S2", text: "Kit primeiros socorros" }, { id: "S3", text: "Equipamento para salvamento e resgate" }, { id: "S4", text: "Kit sobrevivência" }, { id: "S5", "text": "EPI e EPC adequados" }] };
                let userId = null, allAssessments = [], filteredAssessments = [], analysisChart = null, assessmentSummaryChart = null;

                // Trata da autenticação para ambos os ambientes (Canvas e standalone)
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        loadAssessments();
                    } else {
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (e) {
                            console.error("Auth Error:", e);
                        }
                    }
                });

                const showNotification = (message, isError = false) => {
                    const notification = document.getElementById('notification');
                    notification.textContent = message;
                    notification.className = 'show ' + (isError ? 'bg-red-500' : 'bg-blue-500');
                    setTimeout(() => notification.classList.remove('show'), 3000);
                };
                
                // --- LÓGICA DA MATRIZ CORRIGIDA (BASEADA NO SCORE) ---
                const getRiskClassification = (score) => {
                    score = parseInt(score);
                    if (score >= 16) return { level: "Risco Extremo", colorClass: "risk-extreme", recommendation: "Cancelar", treatment: "Deve cancelar a atividade se não conseguir corrigir o risco." };
                    if (score >= 10) return { level: "Risco Elevado", colorClass: "risk-high", recommendation: "Alerta", treatment: "Deve estar em alerta e tentar corrigir os riscos." };
                    if (score >= 5) return { level: "Risco Moderado", colorClass: "risk-moderate", recommendation: "Ponderada", treatment: "Não compromete, mas requer gestão ponderada." };
                    return { level: "Risco Baixo", colorClass: "risk-low", recommendation: "Recomendada", treatment: "Não compromete a atividade." };
                };
                
                const createRiskMatrix = (factorId) => { 
                    let h = `<div class="risk-matrix-container"><div class="axis-label">Probabilidade</div><div class="risk-matrix" data-factor-id="${factorId}">`; 
                    for (let p = 5; p >= 1; p--) {
                        for (let c = 1; c <= 5; c++) { 
                            const s = p * c;
                            const cl = getRiskClassification(s); // Cor da célula baseada no score
                            h += `<div class="matrix-cell ${cl.colorClass} ${p===1&&c===1?'selected':''}" data-prob="${p}" data-cons="${c}" data-score="${s}" title="P:${p},C:${c},S:${s}">${s}</div>`; 
                        }
                    } 
                    h += `</div><div></div><div class="consequence-labels">${[...Array(5).keys()].map(i=>`<span>${i+1}</span>`).join('')}</div><div></div><div class="text-center text-xs font-semibold text-gray-600 col-span-5">Consequência</div></div>`; 
                    return h; 
                };
                
                const changeTab = (tabId) => {
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    document.getElementById('tab-' + tabId).classList.add('active');
                };

                const renderFase1 = () => {
                    const container = document.getElementById('fase1');
                    container.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Informações Gerais</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="companyName" class="block text-sm font-medium text-gray-700">Nome da Empresa/Instituição</label><input type="text" id="companyName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="preliminaryDate" class="block text-sm font-medium text-gray-700">Data da Análise Preliminar</label><input type="date" id="preliminaryDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="technicianName" class="block text-sm font-medium text-gray-700">Nome do Técnico</label><input type="text" id="technicianName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="technicianAge" class="block text-sm font-medium text-gray-700">Idade</label><input type="number" id="technicianAge" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Verificação das Medidas de Segurança</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm" id="medidas-seguranca-container"></div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Material e Equipamento de Segurança e Emergência</h2>
                            <div id="material-emergencia-container"></div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md no-print">
                            <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Ações da Fase 1</h2>
                            <div class="flex flex-wrap gap-4">
                                <button id="save-fase1-btn" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Guardar Registo</button>
                                <button id="export-fase1-pdf-btn" class="btn btn-secondary font-bold py-2 px-4 rounded-lg">Exportar (PDF)</button>
                                <button id="export-fase1-excel-btn" class="btn btn-success font-bold py-2 px-4 rounded-lg">Exportar (Excel)</button>
                            </div>
                        </div>`;
                    
                    const medidasContainer = document.getElementById('medidas-seguranca-container');
                    medidasSeguranca.forEach((m, i) => {
                        const l = document.createElement('label');
                        l.className = 'flex items-start space-x-3 p-2 rounded-md hover:bg-gray-50';
                        l.innerHTML = `<input type="checkbox" data-measure-text="${m}" class="h-4 w-4 text-blue-600 rounded mt-1"><span class="flex-1">${i + 1}. ${m}</span>`;
                        medidasContainer.appendChild(l);
                    });

                    const materialContainer = document.getElementById('material-emergencia-container');
                    for (const cat in materialEmergencia) {
                        const div = document.createElement('div');
                        div.className = 'bg-gray-50 p-4 rounded-lg';
                        div.innerHTML = `<h3 class="font-semibold text-md">${cat}</h3><div class="mt-2 space-y-1">${materialEmergencia[cat].map(item => `<label class="flex items-center space-x-2 py-1"><input type="checkbox" data-material-text="${item}" data-material-category="${cat}" class="h-4 w-4 text-blue-600 rounded"><span class="text-sm">${item}</span></label>`).join('')}</div>`;
                        materialContainer.appendChild(div);
                    }
                    document.getElementById('preliminaryDate').valueAsDate = new Date();
                    document.getElementById('export-fase1-pdf-btn').addEventListener('click', () => exportPdf('#fase1'));
                    document.getElementById('export-fase1-excel-btn').addEventListener('click', exportPhase1Excel);
                    document.getElementById('save-fase1-btn').addEventListener('click', saveAssessment);
                };
                
                const renderFase2 = () => {
                    const container = document.getElementById('fase2');
                    container.innerHTML = `
                        <div class="card p-6 mb-8">
                            <h2 class="text-2xl font-bold mb-4 text-gray-700 border-b pb-2">Informações da Avaliação</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="evaluatorName" class="block text-sm font-medium">Nome do Avaliador</label><input type="text" id="evaluatorName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="evalDate" class="block text-sm font-medium">Data</label><input type="date" id="evalDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="location" class="block text-sm font-medium">Local da Atividade</label><input type="text" id="location" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                                <div><label for="activity" class="block text-sm font-medium">Atividade</label><input type="text" id="activity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                            </div>
                        </div>
                        <div id="risk-factors-container"></div>
                        <div class="card p-6 mt-8">
                            <h2 class="text-2xl font-bold mb-4 text-gray-700 border-b pb-2">Resultados e Ações</h2>
                            <div class="flex flex-wrap gap-4 mb-6 no-print">
                                <button id="calculate-btn-assessment" class="btn btn-primary font-bold py-2 px-4 rounded-lg">Calcular Resultados</button>
                                <button id="save-assessment-btn" class="btn btn-secondary font-bold py-2 px-4 rounded-lg">Guardar Avaliação</button>
                                <button id="export-pdf-btn" class="btn btn-secondary font-bold py-2 px-4 rounded-lg">Exportar (PDF)</button>
                                <button id="export-excel-btn" class="btn btn-success font-bold py-2 px-4 rounded-lg">Exportar (Excel)</button>
                                <button id="clear-btn" class="btn btn-danger font-bold py-2 px-4 rounded-lg">Limpar</button>
                            </div>
                            <div id="results-content-assessment" class="hidden">
                                <div id="extreme-risk-summary-container" class="hidden mb-8"></div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div><h3 class="text-xl font-semibold mb-3">Avaliação Geral</h3><div id="overall-result"></div></div>
                                    <div><h3 class="text-xl font-semibold mb-3">Resumo por Dimensão</h3><div class="h-64"><canvas id="assessment-summary-chart"></canvas></div></div>
                                </div>
                            </div>
                        </div>`;
                    const riskContainer = document.getElementById('risk-factors-container');
                    for(const dim in riskData){
                        const card = document.createElement('div'); card.className='card mb-8';
                        card.innerHTML = `<h2 class="text-2xl font
